
# 校歌バトル（教室対抗）

ブラウザのマイクで**相対音量（RMS/Peak）**と**安定性（振幅の揺らぎ）**、**ピッチ誤差**を測り、
PINで同じ大会に参加した各教室のスコアをリアルタイム集計します。

## セットアップ

```bash
npm install
npm start
# http://localhost:3000 を開く
```

## 使い方（最短）
1. 主催者が「大会を作成」→ 表示された PIN を各教室に伝える  
2. 各教室は PIN とクラス名を入れて入室、**静音キャリブ**を実施  
3. 主催が「ラウンド開始」を押すと 3 秒後に同時スタート  
4. 計測終了後、自動で順位表が更新されます

## 主な仕様
- WebSocket によるリアルタイム同期（/ws）
- ラウンドはサーバー時刻基準で一斉スタート（遅延差を軽減）
- スコア：
  - Loud（40点）：RMS/Peak（noiseFloor との差分で相対化）
  - Unity（25点）：フレーム間の振幅変動の小ささ（簡易）
  - Pitch（25点）：A3(220Hz)とのピッチ誤差（±50¢内で満点近く）
  - Adj（±10点）：Clip率による減点
- 人数正規化：合計点は単純に人数で割る係数をかけています（`app.js` の最後の計算）。

## 既知の留意点 / 拡張
- ブラウザの AGC/NS/Echo の動作は端末依存です。UIのゲイン補正や再キャリブで調整してください。
- ガイド音源（MP3/WAV）は**各教室でローカル選択**して再生可能（主催パネル右側）。
- 合唱用の歌詞表示は簡易版（タイムタグなしハイライト）。
- マルチマイク集約（PC＋スマホ数台）やトーナメント集計は今後の拡張で対応可能です。
